name: Build

on:
    workflow_dispatch:
    workflow_call:
        outputs:
            build-success:
                description: 'Whether the build completed successfully'
                value:
                    ${{
                        jobs.windows.result == 'success' && 
                        jobs.linux.result == 'success' && 
                        jobs.darwin_x64.result == 'success' &&
                        jobs.darwin_arm64.result == 'success'
                    }}
    pull_request:
        paths-ignore:
            - 'doc/**'
    push:
        branches:
            - main
        paths-ignore:
            - 'doc/**'

jobs:
    windows:
        uses: ./.github/workflows/build_win.yml
        secrets: inherit
    linux:
        uses: ./.github/workflows/build_linux.yml
        secrets: inherit
    darwin_x64:
        uses: ./.github/workflows/build_darwin.yml
        secrets: inherit
        with:
            arch: x64
    darwin_arm64:
        uses: ./.github/workflows/build_darwin.yml
        secrets: inherit
        with:
            arch: arm64
