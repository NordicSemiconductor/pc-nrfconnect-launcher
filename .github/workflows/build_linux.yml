name: Prepare nRF Connect for Desktop build

on:
    workflow_call:
        inputs:
            runner:
                required: true
                type: string # [Windows, macOS, Linux]
            electronArgument:
                required: true
                type: string # e.g. --windows nsis:x64

jobs:
    build:
        runs-on: ${{ fromJSON(inputs.runner) }}
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                  node-version: 18
                  cache: 'npm'

            - name: Build
              uses: ./.github/workflows/build.yml

            - name: Run Electron Builder
              run: npx electron-builder -p never ${{ inputs.electronArgument }}

            - name: Publish built artifact
              uses: actions/upload-artifact@v3
              with:
                  name: nRF Connect for Desktop linux
                  path: 'release/nrfconnect*'
                  retention-days: 7
                  compression-level: 0
